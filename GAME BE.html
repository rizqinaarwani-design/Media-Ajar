<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Urut Kata - MI NU Hidayatul Mubtadiin</title>
    <style>
        :root {
            --primary: #4a90e2;
            --secondary: #f39c12;
            --success: #2ecc71;
            --danger: #e74c3c;
            --white: #ffffff;
            --bg: #f0f3f5;
        }

        * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

        body {
            margin: 0;
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
        }

        #app {
            width: 95%;
            max-width: 600px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            text-align: center;
            position: relative;
        }

        h1 { color: var(--primary); font-size: 1.6rem; margin-bottom: 5px; }
        .creator { font-size: 0.8rem; color: #666; margin-bottom: 15px; }

        .info-bar { 
            display: flex; 
            justify-content: space-between; 
            margin-bottom: 10px; 
            font-weight: bold; 
            color: #444;
            background: #eee;
            padding: 10px;
            border-radius: 10px;
            font-size: 0.9rem;
        }

        #question-number {
            background: var(--primary);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 10px;
        }

        /* Login Screen */
        #login-screen input {
            width: 85%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
        }

        /* Game Areas */
        .word-pool, .answer-zone {
            min-height: 100px;
            border: 3px dashed #cbd5e0;
            border-radius: 20px;
            padding: 15px;
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            background: rgba(255,255,255,0.5);
        }

        .answer-zone { border-color: var(--primary); background: #ebf8ff; }

        /* Balloon Style */
        .balloon {
            padding: 12px 18px;
            border-radius: 50px;
            cursor: pointer;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: 0.2s;
            display: inline-block;
            user-select: none;
            border: 2px solid rgba(255,255,255,0.3);
            font-size: 0.9rem;
        }

        .balloon:active { transform: scale(0.9); }

        button {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: 0.3s;
            width: 80%;
        }

        button:hover { transform: translateY(-2px); opacity: 0.9; }

        /* Confetti */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            z-index: 1000;
            top: -10px;
            animation: fall 3s linear forwards;
        }

        .hidden { display: none !important; }
        
        @keyframes fall {
            to { transform: translateY(100vh) rotate(360deg); }
        }
    </style>
</head>
<body>

<div id="app">
    <!-- Screen 1: Login -->
    <div id="login-screen">
        <h1>URUT KATA INGGRIS</h1>
        <div class="creator">Oleh: Bapak Mohammad Arwani, S.Pd.I</div>
        <p>Halo Anak-anak Hebat Kelas 6A!<br>Silakan isi data dirimu:</p>
        <input type="text" id="student-name" placeholder="Nama Lengkap" required><br>
        <input type="number" id="student-absent" placeholder="Nomor Absen" required><br><br>
        <button onclick="startGame()">MULAI BERMAIN</button>
    </div>

    <!-- Screen 2: Gameplay -->
    <div id="game-screen" class="hidden">
        <div class="info-bar">
            <span>üë§ <span id="display-name"></span></span>
            <span>üèÜ Skor: <span id="display-score">0</span></span>
        </div>
        
        <div id="question-number">Soal 1 dari 20</div>
        
        <div class="answer-zone" id="answer-zone" onclick="moveToPool(event)">
            <!-- Kata yang dipilih masuk sini -->
        </div>

        <div class="word-pool" id="word-pool" onclick="moveToAnswer(event)">
            <!-- Kata acak ada di sini -->
        </div>

        <button onclick="checkAnswer()">CEK JAWABAN</button>
        <p id="feedback-msg" style="font-weight: bold; margin-top: 15px; min-height: 20px;"></p>
    </div>

    <!-- Screen 3: Result -->
    <div id="result-screen" class="hidden">
        <h1>üéâ GAME OVER üéâ</h1>
        <div id="final-stats" style="text-align: left; display: inline-block; margin: 20px 0; font-size: 1.1rem; line-height: 1.8; background: #f9f9f9; padding: 20px; border-radius: 15px; border: 1px solid #ddd; width: 90%;">
        </div>
        <br>
        <button onclick="location.reload()" style="margin-bottom: 10px;">BERMAIN LAGI</button>
        <button onclick="window.close(); alert('Silakan tutup tab ini.')" style="background: #95a5a6;">SELESAI</button>
    </div>
</div>

<script>
    const sentences = [
        "I go to school every day",
        "My mother is cooking in the kitchen",
        "The cat is sleeping on the table",
        "We are studying English now",
        "I have a big brother",
        "She is my best friend",
        "They play football in the field",
        "My father works in an office",
        "Please open the window",
        "How are you today",
        "I eat breakfast at six o'clock",
        "There is a bird on the tree",
        "Jakarta is the capital of Indonesia",
        "Can you help me",
        "Red is my favorite color",
        "We must keep our classroom clean",
        "Don't forget to wash your hands",
        "I want to be a doctor",
        "The sun rises in the east",
        "Do you like reading a book"
    ];

    let currentQuestion = 0;
    let score = 0;
    let startTime;
    let name = "";
    let absent = "";
    const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7D794', '#778BEB', '#F8a5c2'];

    const synth = window.speechSynthesis;

    // Memastikan suara terload
    function getVoice(lang, gender) {
        const voices = synth.getVoices();
        if (lang === 'id') {
            return voices.find(v => v.lang.includes('id') && v.name.includes('Female')) || voices.find(v => v.lang.includes('id'));
        } else {
            return voices.find(v => v.lang.includes('en') && v.name.includes('Male')) || voices.find(v => v.lang.includes('en'));
        }
    }

    function speak(text, lang = 'id', rate = 1) {
        synth.cancel(); // Hentikan suara sebelumnya
        const utter = new SpeechSynthesisUtterance(text);
        
        if (lang === 'id') {
            utter.lang = 'id-ID';
            utter.voice = getVoice('id');
        } else {
            utter.lang = 'en-US';
            utter.voice = getVoice('en');
        }
        
        utter.rate = rate;
        synth.speak(utter);
    }

    function startGame() {
        name = document.getElementById('student-name').value;
        absent = document.getElementById('student-absent').value;

        if (!name || !absent) {
            alert("Harap isi nama dan nomor absen!");
            return;
        }

        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('game-screen').classList.remove('hidden');
        document.getElementById('display-name').innerText = name;
        
        startTime = new Date();

        // Voice Opening
        const openingText = `SELAMAT BERMAIN URUT KATA INGGRIS, DI DESAIN OLEH BAPAK MOHAMMAD ARWANI, SARJANA PENDIDIKAN ISLAM, YANG DIDESAIN KHUSUS UNTUK SISWA KELAS ENAM A, MI NU HIDAYATUL MUBTADIIN, UNDAAN KIDUL, UNTUK MENGISI LIBURAN SEKOLAH, SEMOGA BERMANFAAT`;
        speak(openingText, 'id');

        // Beri jeda sedikit agar suara pembuka selesai/mulai sebelum soal muncul
        setTimeout(() => {
            loadQuestion();
        }, 500);
    }

    function loadQuestion() {
        if (currentQuestion >= sentences.length) {
            endGame();
            return;
        }

        document.getElementById('question-number').innerText = `Soal ${currentQuestion + 1} dari ${sentences.length}`;
        document.getElementById('feedback-msg').innerText = "";
        document.getElementById('answer-zone').innerHTML = "";
        const pool = document.getElementById('word-pool');
        pool.innerHTML = "";

        const originalSentence = sentences[currentQuestion];
        let words = originalSentence.split(' ');
        
        // Acak kata
        const shuffled = [...words].sort(() => Math.random() - 0.5);

        shuffled.forEach((word, index) => {
            const b = document.createElement('div');
            b.className = 'balloon';
            b.innerText = word;
            b.style.backgroundColor = colors[index % colors.length];
            pool.appendChild(b);
        });

        // Panduan suara setiap soal
        setTimeout(() => {
            speak("Tolong urutkan kata-kata berikut ini sehingga membentuk kalimat yang benar", 'id');
        }, 1000);
    }

    function moveToAnswer(e) {
        if (e.target.className === 'balloon') {
            document.getElementById('answer-zone').appendChild(e.target);
        }
    }

    function moveToPool(e) {
        if (e.target.className === 'balloon') {
            document.getElementById('word-pool').appendChild(e.target);
        }
    }

    function checkAnswer() {
        const userWords = Array.from(document.querySelectorAll('#answer-zone .balloon')).map(b => b.innerText);
        const userAnswer = userWords.join(' ');
        const correctAnswer = sentences[currentQuestion];

        if (userAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
            score += 5;
            document.getElementById('display-score').innerText = score;
            document.getElementById('feedback-msg').style.color = 'green';
            document.getElementById('feedback-msg').innerText = "‚úÖ Jawaban Kamu Benar! (+5)";
            speak("Jawaban Kamu Benar", 'id');
            
            setTimeout(() => {
                currentQuestion++;
                loadQuestion();
            }, 2000);
        } else {
            document.getElementById('feedback-msg').style.color = 'red';
            document.getElementById('feedback-msg').innerText = "‚ùå Jawaban Kamu Salah";
            speak("Jawaban Kamu Salah", 'id');
            
            // Bacakan kalimat yang benar (Suara Pria Inggris)
            setTimeout(() => {
                speak(correctAnswer, 'en', 0.8);
            }, 1500);

            setTimeout(() => {
                currentQuestion++;
                loadQuestion();
            }, 4500);
        }
    }

    function endGame() {
        const endTime = new Date();
        const timeDiff = Math.floor((endTime - startTime) / 1000);
        const minutes = Math.floor(timeDiff / 60);
        const seconds = timeDiff % 60;

        document.getElementById('game-screen').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');

        document.getElementById('final-stats').innerHTML = `
            <strong>Nama:</strong> ${name}<br>
            <strong>No. Absen:</strong> ${absent}<br>
            <strong>Waktu Belajar:</strong> ${minutes} menit ${seconds} detik<br>
            <strong>Total Skor Akhir:</strong> <span style="font-size: 2rem; color: #2ecc71;">${score}</span>
        `;

        createConfetti();
        speak("Kamu anak hebat. Apakah mau bermain game lagi?", 'id');
    }

    function createConfetti() {
        for (let i = 0; i < 80; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 90 + 'vw';
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.animationDelay = Math.random() * 2 + 's';
            document.body.appendChild(confetti);
            
            setTimeout(() => confetti.remove(), 4000);
        }
    }

    // Trigger pre-load voices
    window.speechSynthesis.getVoices();
    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = () => speechSynthesis.getVoices();
    }
</script>

</body>
</html>